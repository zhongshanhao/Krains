<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>垃圾回收器 | Krains&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/sign3.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
    <meta name="description" content="From zero to hero.">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/assets/css/0.styles.b23ada8b.css" as="style"><link rel="preload" href="/assets/js/app.a8ba8ec0.js" as="script"><link rel="preload" href="/assets/js/3.a516c195.js" as="script"><link rel="preload" href="/assets/js/1.0740cc03.js" as="script"><link rel="preload" href="/assets/js/59.8b5b91b1.js" as="script"><link rel="prefetch" href="/assets/js/10.ed1f12d5.js"><link rel="prefetch" href="/assets/js/11.1073bea5.js"><link rel="prefetch" href="/assets/js/12.68449876.js"><link rel="prefetch" href="/assets/js/13.1331231b.js"><link rel="prefetch" href="/assets/js/14.c15f1f1c.js"><link rel="prefetch" href="/assets/js/15.be441237.js"><link rel="prefetch" href="/assets/js/16.33a2b0b5.js"><link rel="prefetch" href="/assets/js/17.bc6b9747.js"><link rel="prefetch" href="/assets/js/18.5a640edb.js"><link rel="prefetch" href="/assets/js/19.e8e71982.js"><link rel="prefetch" href="/assets/js/20.6d3eca64.js"><link rel="prefetch" href="/assets/js/21.3c791bd6.js"><link rel="prefetch" href="/assets/js/22.ac44fd28.js"><link rel="prefetch" href="/assets/js/23.5f9c7a68.js"><link rel="prefetch" href="/assets/js/24.41ea44d7.js"><link rel="prefetch" href="/assets/js/25.be315547.js"><link rel="prefetch" href="/assets/js/26.b18edc61.js"><link rel="prefetch" href="/assets/js/27.e582d002.js"><link rel="prefetch" href="/assets/js/28.b90ecc0c.js"><link rel="prefetch" href="/assets/js/29.f1e16fea.js"><link rel="prefetch" href="/assets/js/30.61daf30e.js"><link rel="prefetch" href="/assets/js/31.34e135f8.js"><link rel="prefetch" href="/assets/js/32.f187d05d.js"><link rel="prefetch" href="/assets/js/33.e5ee78bc.js"><link rel="prefetch" href="/assets/js/34.619b4e2a.js"><link rel="prefetch" href="/assets/js/35.590d4746.js"><link rel="prefetch" href="/assets/js/36.b7d96d5c.js"><link rel="prefetch" href="/assets/js/37.1c1d7890.js"><link rel="prefetch" href="/assets/js/38.3f81a62a.js"><link rel="prefetch" href="/assets/js/39.97bdf789.js"><link rel="prefetch" href="/assets/js/4.e464aa50.js"><link rel="prefetch" href="/assets/js/40.848006f3.js"><link rel="prefetch" href="/assets/js/41.febfd4b4.js"><link rel="prefetch" href="/assets/js/42.93e06a6e.js"><link rel="prefetch" href="/assets/js/43.28fbba8d.js"><link rel="prefetch" href="/assets/js/44.0ab7771e.js"><link rel="prefetch" href="/assets/js/45.86f34f02.js"><link rel="prefetch" href="/assets/js/46.60c91c8d.js"><link rel="prefetch" href="/assets/js/47.27ea786c.js"><link rel="prefetch" href="/assets/js/48.8e32d544.js"><link rel="prefetch" href="/assets/js/49.a6379f9d.js"><link rel="prefetch" href="/assets/js/5.edd4c672.js"><link rel="prefetch" href="/assets/js/50.76dfc8fa.js"><link rel="prefetch" href="/assets/js/51.0f136b52.js"><link rel="prefetch" href="/assets/js/52.f9c627f3.js"><link rel="prefetch" href="/assets/js/53.87ac23c0.js"><link rel="prefetch" href="/assets/js/54.cc9d464f.js"><link rel="prefetch" href="/assets/js/55.5d82cd7e.js"><link rel="prefetch" href="/assets/js/56.a3d8c7b9.js"><link rel="prefetch" href="/assets/js/57.0aed6ccf.js"><link rel="prefetch" href="/assets/js/58.71dfb61d.js"><link rel="prefetch" href="/assets/js/6.ffda8234.js"><link rel="prefetch" href="/assets/js/60.b383a2c9.js"><link rel="prefetch" href="/assets/js/61.8b5f4699.js"><link rel="prefetch" href="/assets/js/62.20d19f6e.js"><link rel="prefetch" href="/assets/js/63.d017a10c.js"><link rel="prefetch" href="/assets/js/64.9677b2ea.js"><link rel="prefetch" href="/assets/js/65.49db3c1c.js"><link rel="prefetch" href="/assets/js/66.8735dd6f.js"><link rel="prefetch" href="/assets/js/67.431c94c8.js"><link rel="prefetch" href="/assets/js/68.fa67e675.js"><link rel="prefetch" href="/assets/js/69.bf770da2.js"><link rel="prefetch" href="/assets/js/7.c73cd78d.js"><link rel="prefetch" href="/assets/js/70.d3b63196.js"><link rel="prefetch" href="/assets/js/71.952b52ba.js"><link rel="prefetch" href="/assets/js/72.84ba5e5d.js"><link rel="prefetch" href="/assets/js/73.7d183def.js"><link rel="prefetch" href="/assets/js/74.5eb76d81.js"><link rel="prefetch" href="/assets/js/75.fe036ac4.js"><link rel="prefetch" href="/assets/js/76.91312ab9.js"><link rel="prefetch" href="/assets/js/77.17d5c6e1.js"><link rel="prefetch" href="/assets/js/78.8695f7fe.js"><link rel="prefetch" href="/assets/js/79.e87518f5.js"><link rel="prefetch" href="/assets/js/8.252cf79f.js"><link rel="prefetch" href="/assets/js/9.e3d246bb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b23ada8b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-dad8a512><div data-v-dad8a512><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-dad8a512 data-v-dad8a512><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-dad8a512 data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>Krains's Blog</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Krains</span>
            
          <!---->
          2020
        </a></span></div></div> <div class="hide" data-v-dad8a512><header class="navbar" data-v-dad8a512><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/sign3.png" alt="Krains's Blog" class="logo"> <span class="site-name">Krains's Blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Algorithm/" class="nav-link"><i class="iconfont undefined"></i>
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据结构/" class="nav-link"><i class="iconfont undefined"></i>
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/categories/LeetCode题解/" class="nav-link"><i class="iconfont undefined"></i>
  LeetCode题解
</a></li><li class="dropdown-item"><!----> <a href="/categories/计算机基础知识/" class="nav-link"><i class="iconfont undefined"></i>
  计算机基础知识
</a></li><li class="dropdown-item"><!----> <a href="/categories/JVM/" class="nav-link"><i class="iconfont undefined"></i>
  JVM
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://zhongshanhao.github.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-dad8a512></div> <aside class="sidebar" data-v-dad8a512><div class="personal-info-wrapper" data-v-ca798c94 data-v-dad8a512><img src="/avatar2.png" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    Krains
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>56</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>18</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Algorithm/" class="nav-link"><i class="iconfont undefined"></i>
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据结构/" class="nav-link"><i class="iconfont undefined"></i>
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/categories/LeetCode题解/" class="nav-link"><i class="iconfont undefined"></i>
  LeetCode题解
</a></li><li class="dropdown-item"><!----> <a href="/categories/计算机基础知识/" class="nav-link"><i class="iconfont undefined"></i>
  计算机基础知识
</a></li><li class="dropdown-item"><!----> <a href="/categories/JVM/" class="nav-link"><i class="iconfont undefined"></i>
  JVM
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://zhongshanhao.github.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Jvm</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogs/Jvm/Java String.html" class="sidebar-link">Java String</a></li><li><a href="/blogs/Jvm/垃圾回收器.html" class="active sidebar-link">垃圾回收器</a></li><li><a href="/blogs/Jvm/垃圾回收相关概念.html" class="sidebar-link">垃圾回收相关概念</a></li><li><a href="/blogs/Jvm/垃圾收集算法.html" class="sidebar-link">垃圾收集算法</a></li><li><a href="/blogs/Jvm/字节码文件.html" class="sidebar-link">字节码文件</a></li><li><a href="/blogs/Jvm/对象实例化内存布局与访问定位.html" class="sidebar-link">对象实例化内存布局与访问定位</a></li><li><a href="/blogs/Jvm/类加载子系统.html" class="sidebar-link">类加载子系统</a></li><li><a href="/blogs/Jvm/运行时数据区.html" class="sidebar-link">运行时数据区</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>垃圾回收器</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Krains</span>
            
          <!---->
          2020
        </a></span></div></div> <div data-v-dad8a512><main class="page"><div class="page-title" style="display:none;"><h1>垃圾回收器</h1> <hr> <div data-v-aa64b9d0><i class="iconfont reco-account" data-v-aa64b9d0><span data-v-aa64b9d0>Krains</span></i> <i class="iconfont reco-date" data-v-aa64b9d0><span data-v-aa64b9d0>2020-08-07</span></i> <i class="iconfont reco-eye" data-v-aa64b9d0><span id="/blogs/Jvm/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-aa64b9d0><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><h2 id="评估gc的主要性能指标"><a href="#评估gc的主要性能指标" class="header-anchor">#</a> 评估GC的主要性能指标</h2> <ul><li>吞吐量：运行用户代码的时间占总运行时间的比例（总运行时间=程序运行时间+内存回收时间）</li> <li>暂停时间：执行垃圾收集时，程序的工作线程被暂停的时间</li></ul> <h2 id="吞吐量vs暂停时间"><a href="#吞吐量vs暂停时间" class="header-anchor">#</a> 吞吐量vs暂停时间</h2> <p>高吞吐量较好因为这会让应用程序的最终用户感觉只有应用程序线程在做“生产性”工作。直觉上，吞吐量越高程序运行越快。</p> <p>低暂停时间（低延迟）较好因为从最终用户的角度来看不管是GC还是其他原因导致一个应用被挂起始终是不好的。这取决于应用程序的类型，有时候甚至短暂的200毫秒暂停都可能打断终端用户体验。因此，具有低的较大暂停时间是非常重要的，特别是对于一个交互式应用程序。</p> <p>不幸的是“高吞吐量”和“低暂停时间”是一对相互竞争的目标（矛盾）。</p> <p>因为如果选择以吞吐量优先，那么必然需要降低内存回收的执行频率，但是这样会导致GC需要更长的暂停时间来执行内存回收。</p> <p>相反的，如果选择以低延迟优先为原则，那么为了降低每次执行内存回收时的暂停时间，也只能频繁地执行内存回收，但这又引起了年轻代内存的缩减和导致程序吞吐量的下降。</p> <p>在设计（或使用）GC算法时，我们必须确定我们的目标：一个GC算法只可能针对两个目标之一（即只专注于较大吞吐量或最小暂停时间），或尝试找到一个二者的折衷。</p> <p>目前的标准：在最大吞吐量优先的情况下，降低停顿时间。</p> <h2 id="_7种经典的垃圾回收器"><a href="#_7种经典的垃圾回收器" class="header-anchor">#</a> 7种经典的垃圾回收器</h2> <ul><li>串行回收器：Serial、Serial old</li> <li>并行回收器：ParNew、Parallel Scavenge、Parallel old</li> <li>并发回收器：CMS、G1</li></ul> <p>串行和并行回收器会STW，并发回收器可以在执行垃圾回收的时候执行用户线程。</p> <p><img src="https://gitee.com/Krains/FigureBed/raw/master/img/%E7%BB%8F%E5%85%B8%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8.png" alt="经典的垃圾回收器"></p> <p>未来：ZGC</p> <h2 id="_7种垃圾收集器的组合关系"><a href="#_7种垃圾收集器的组合关系" class="header-anchor">#</a> 7种垃圾收集器的组合关系</h2> <p><img src="https://gitee.com/Krains/FigureBed/raw/master/img/%E7%BB%8F%E5%85%B8%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E7%9A%84%E7%BB%84%E5%90%88.png" alt="经典垃圾收集器的组合"></p> <p>按照分代分类</p> <ul><li>新生代收集器：Serial、ParNew、Paralle1 Scavenge</li> <li>老年代收集器：Serial old、Parallel old、CMS</li> <li>整堆收集器：G1</li></ul> <p>各垃圾回收器组合使用说明</p> <ul><li>其中Serial o1d作为CMS出现&quot;Concurrent Mode Failure&quot;失败的后备预案，即当垃圾产生的速度大于回收的速度时，CMS无法更快的垃圾回收，这时候启用Serial Old停掉用户线程全力做垃圾操作。</li> <li>红色虚线：由于维护和兼容性测试的成本，在JDK8时将Serial+CMS、ParNew+Serial old这两个组合声明为废弃（JEP173），并在JDK9中完全取消了这些组合的支持（JEP214），即：移除。</li> <li>绿色虚线：JDK14中：弃用Paralle1 Scavenge和Serialold GC组合（JEP366）</li> <li>青色虚线：JDK14中：删除CMS垃圾回收器（JEP363）</li></ul> <p>查看使用的垃圾回收器</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">PrintcommandLineFlags</span>   <span class="token comment">// 查看命令行相关参数（包含使用的垃圾收集器）</span>

<span class="token comment">// 命令行</span>
jps   <span class="token comment">// 查看运行的java线程</span>
<span class="token comment">// 查看jvm是否使用了某个参数：&quot;+&quot;表示使用了，&quot;-&quot;表示不使用</span>
jinfo <span class="token operator">-</span>flag 相关垃圾回收器参数 进程ID
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="serial回收器：串行回收"><a href="#serial回收器：串行回收" class="header-anchor">#</a> Serial回收器：串行回收</h2> <p>年轻代中：Serial收集器采用复制算法、串行回收和STW机制的方式执行内存回收。
老年代中：Serial Old采用标记压缩算法、串行回收和STW机制</p> <p><img src="https://gitee.com/Krains/FigureBed/raw/master/img/Serial&amp;Serial%20Old.png" alt="Serial&amp;Serial Old"></p> <p>这个收集器是一个单线程的收集器，单线程不仅仅说明它只会使用一个CPU或一条收集线程去完成垃圾收集工作，而且在它回收垃圾时，必须要暂停其他所有工作线程，直到它收集结束(STW)。</p> <p>优点：简单高效，没有线程切换的开销</p> <p>配置使用Serial回收器，年轻代使用Serial，老年代使用Serial Old</p> <blockquote><p>-XX:+UseSerialGC</p></blockquote> <h2 id="parnew回收器：并行回收"><a href="#parnew回收器：并行回收" class="header-anchor">#</a> ParNew回收器：并行回收</h2> <p>ParNew收集器是Serial收集器的多线程版本，ParNew收集器在年轻代使用的是复制算法、并行回收、STW机制。</p> <p><img src="https://gitee.com/Krains/FigureBed/raw/master/img/ParNew&amp;Serial%20Old.png" alt="ParNew&amp;Serial Old"></p> <ul><li>对于新生代，回收次数频繁，使用并行方式高效。</li> <li>对于老年代，回收次数少，使用串行方式节省资源。（CPU并行需要切换线程，串行可以省去切换线程的资源）</li></ul> <blockquote><p>-XX:+UseParNewGC
-XX:ParallelGCThreads限制线程数量，默认开启和CPU数据相同的线程数。</p></blockquote> <h2 id="parallel回收器：吞吐量优先"><a href="#parallel回收器：吞吐量优先" class="header-anchor">#</a> Parallel回收器：吞吐量优先</h2> <p>HotSpot的年轻代中除了拥有ParNew收集器是基于并行回收的以外，Parallel Scavenge收集器同样也采用了复制算法、并行回收和&quot;Stop the World&quot;机制。</p> <p>那么Parallel Scavenge收集器的出现是否多此一举？</p> <ul><li>和ParNew收集器不同，Parallel Scavenge收集器的目标则是达到一个可控制的吞吐量（Throughput），它也被称为吞吐量优先的垃圾收集器。</li> <li>自适应调节策略也是Paralle1 Scavenge与ParNew一个重要区别。</li></ul> <p>高吞吐量则可以高效率地利用CPU时间，尽快完成程序的运算任务，主要适合在后台运算而不需要太多交互的任务。因此，常见在服务器环境中使用。例如，那些执行批量处理、订单处理、工资支付、科学计算的应用程序。</p> <p>Paralle1收集器在JDK1.6时提供了用于执行老年代垃圾收集的Paralle1o1d收集器，用来代替老年代的serialold收集器。</p> <p>Parallel old收集器采用了标记-压缩算法，但同样也是基于并行回收和STW机制。</p> <p><img src="https://gitee.com/Krains/FigureBed/raw/master/img/Parallel&amp;Old.png" alt="Parallel&amp;Old"></p> <p>在程序吞吐量优先的场景下，Parallel Scavenge和Parallel Old收集器组合使用，在Server模式下的内存回收性能不错，JDK8中默认的收集器。</p> <p>Parallel Scavenge回收器的参数设置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 新生代中使用Parallel Scavenge
-XX:+UseParallelGC 

// 老年代中使用Parallel Old，两个参数相互激活
-XX:+UseParallelOldGC

// 设置年轻代并行收集器的线程数
-XX:+ParallelGCThreads

// 设置垃圾收集器最大停顿时间（即STW的时间），单位毫秒
-XX:MaxGCPauseMillis

// 垃圾收集时间占总时间的比例
-XX:GCTimeRatio

// 设置Parallel scavenge收集器具有自适应调节策略
// 在这种模式下，年轻代的大小、Eden和Survivor的比例、晋升老年代的对象年龄等参数会被自动调整，
// 已达到在堆大小、吞吐量和停顿时间之间的平衡点。
-XX:+UseAdaptivesizepplicy
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="cms回收器：低延时"><a href="#cms回收器：低延时" class="header-anchor">#</a> CMS回收器：低延时</h2> <p>CMS（Concurrent-Mark-Sweep）收集器采用标记-清除算法，并且也会STW，只是暂停的时间非常短，适合交互性较强的应用上。</p> <p><img src="https://gitee.com/Krains/FigureBed/raw/master/img/CMS.png" alt="CMS"></p> <p>CMS垃圾收集的过程分为4个阶段</p> <ul><li>初始标记（Initial Mark）阶段：这个阶段的任务只是标记出GCRoots能直接关联的对象，因此这个耗时非常短，在标记过程中会出现STW。</li> <li>并发标记（Concurrent Mark）阶段：从GCRoots直接关联的对象开始遍历出所有与GCRoots间接关联的对象，耗时较长但是不需要停止用户线程。</li> <li>重新标记（Remark）阶段：在上个阶段中，程序的工作线程和垃圾收集线程同时运行或者交叉运行，因此为了修正并发标记期间，因用户线程继续运作而导致标记产生变动的那一部分对象的标记记录，这个阶段会STW</li> <li>并发清除（Concurrent Sweep）阶段：该阶段清理删除掉标记阶段判断的已经死亡的对象，释放内存空间。因为使用的是标记-清除算法，不需要移动存活对象，因此可以和用户线程并发执行</li></ul> <p>由于最耗时的并发标记和并发清除阶段都不需要停止用户线程，所以整体来说是低延时的。</p> <p>另外在垃圾收集阶段用户线程没有中断，在CMS回收过程中，还应确保应用程序有足够的内存可用，因此当堆内存使用率达到某一阈值时，便要开始回收，要是在回收过程中预留的内存无法满足程序需求，就会出现&quot;Concurrent Mode Failure&quot;，这时候JVM将启动后备预案：临时启动Serial Old收集器来重新进行老年代的垃圾收集，而Serial Old是采用的是单线程、标记整理的方式回收垃圾，因此STW的时间较长。</p> <p>CMS为什么不使用标记-整理算法？</p> <p>在并发清理阶段，用户线程是和垃圾收集线程并发执行的，这个时候不能将用户线程正在使用的对象移动，否者就会出错。</p> <p>优点</p> <ul><li>并发收集</li> <li>低延时</li></ul> <p>缺点</p> <ul><li>会产生内存碎片，在无法分配大对象的情况下，不得不提前触发FullGC</li> <li>对 CPU 资源敏感，垃圾收集器会占用一部分线程导致应用程序变慢，导致总体吞吐量降低</li> <li>CMS收集器无法处理浮动垃圾。在垃圾回收过程中，CMS无法及时处理新产生的垃圾，在并发标记阶段由于程序和垃圾收集线程是同时或者交叉运行的，那么并发标记阶段如果产生新的垃圾对象，在重新标记阶段CMS无法对这些对象打上标记，导致不能够及时回收，而要等到下一次GC才能够回收。</li></ul> <p>参数设置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 老年代使用CMS，新生代自动会配置为ParNew垃圾收集器
-XX:+UserConcMarkSweepGC

// 设置堆内存使用率的阈值，一旦达到该阈值，便开始进行回收。JDK5及以前默认是68%，JDK6及以上默认是92%
-XX:CMSInitiatingoccupanyFraction 

// 用于指定在执行完Full GC后对内存空间进行压缩整理，以此避免内存碎片的产生。
-XX：+UseCMSCompactAtFullCollection

//  设置在执行多少次Ful1GC后对内存空间进行压缩整理。
-XX:CMSFullGCsBeforecompaction

// CMS默认启动的线程数是（ParallelGCThreads+3）/ 4，ParallelGCThreads是年轻代并行收集器的线程数。
-XX:ParallelcMSThreads 设置CMS的线程数量。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>小结</p> <ul><li>如果你想要最小化地使用内存和并行开销，请选Serial GC；</li> <li>如果你想要最大化应用程序的吞吐量，请选Parallel GC；</li> <li>如果你想要最小化GC的中断或停顿时间，请选CMS GC。</li></ul> <h2 id="g1回收器：区域分代化"><a href="#g1回收器：区域分代化" class="header-anchor">#</a> G1回收器：区域分代化</h2> <p>官方给G1设定的目标是在延迟可控的情况下获得尽可能的吞吐量。</p> <h3 id="特点"><a href="#特点" class="header-anchor">#</a> 特点</h3></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-40a3448a><li class="level-2" data-v-40a3448a><a href="/blogs/Jvm/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8.html#评估gc的主要性能指标" class="sidebar-link" data-v-40a3448a>评估GC的主要性能指标</a></li><li class="level-2" data-v-40a3448a><a href="/blogs/Jvm/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8.html#吞吐量vs暂停时间" class="sidebar-link" data-v-40a3448a>吞吐量vs暂停时间</a></li><li class="level-2" data-v-40a3448a><a href="/blogs/Jvm/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8.html#_7种经典的垃圾回收器" class="sidebar-link" data-v-40a3448a>7种经典的垃圾回收器</a></li><li class="level-2" data-v-40a3448a><a href="/blogs/Jvm/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8.html#_7种垃圾收集器的组合关系" class="sidebar-link" data-v-40a3448a>7种垃圾收集器的组合关系</a></li><li class="level-2" data-v-40a3448a><a href="/blogs/Jvm/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8.html#serial回收器：串行回收" class="sidebar-link" data-v-40a3448a>Serial回收器：串行回收</a></li><li class="level-2" data-v-40a3448a><a href="/blogs/Jvm/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8.html#parnew回收器：并行回收" class="sidebar-link" data-v-40a3448a>ParNew回收器：并行回收</a></li><li class="level-2" data-v-40a3448a><a href="/blogs/Jvm/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8.html#parallel回收器：吞吐量优先" class="sidebar-link" data-v-40a3448a>Parallel回收器：吞吐量优先</a></li><li class="level-2" data-v-40a3448a><a href="/blogs/Jvm/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8.html#cms回收器：低延时" class="sidebar-link" data-v-40a3448a>CMS回收器：低延时</a></li><li class="level-2" data-v-40a3448a><a href="/blogs/Jvm/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8.html#g1回收器：区域分代化" class="sidebar-link" data-v-40a3448a>G1回收器：区域分代化</a></li><li class="level-3" data-v-40a3448a><a href="/blogs/Jvm/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8.html#特点" class="sidebar-link" data-v-40a3448a>特点</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div></div></div>
    <script src="/assets/js/app.a8ba8ec0.js" defer></script><script src="/assets/js/3.a516c195.js" defer></script><script src="/assets/js/1.0740cc03.js" defer></script><script src="/assets/js/59.8b5b91b1.js" defer></script>
  </body>
</html>
